<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ - Ø³Ø¬Ø§Ø¯ Ø­Ø³ÙŠÙ†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <style>
        :root {
            --alfarabi-blue: #003366; 
            --alfarabi-gold: #b08d57;
            --success: #27ae60;
            --whatsapp: #25D366;
            --bg: #f4f7f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            background: white;
            padding: 35px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-bottom: 6px solid var(--alfarabi-blue);
        }

        header h1 {
            font-size: 28px;
            color: var(--alfarabi-blue);
            margin: 0 0 10px 0;
        }

        header p {
            font-size: 16px;
            color: var(--alfarabi-gold);
            font-weight: bold;
            margin: 0;
            letter-spacing: 1px;
        }

        .main-card {
            max-width: 480px;
            width: 92%;
            margin: 30px auto;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            border: 1px solid #e1e8ed;
        }

        .class-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .class-selector button {
            padding: 15px;
            border: 1px solid #d1d9e0;
            border-radius: 12px;
            background: #fff;
            font-weight: bold;
            cursor: pointer;
            color: var(--alfarabi-blue);
            transition: 0.3s;
        }

        .class-selector button.active {
            background: var(--alfarabi-blue);
            color: white;
            border-color: var(--alfarabi-blue);
        }

        .info-panel {
            display: flex;
            justify-content: space-between;
            background: #f8fafd;
            padding: 18px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-right: 5px solid var(--alfarabi-gold);
        }

        .info-panel b { font-size: 22px; color: var(--alfarabi-blue); }

        #reader {
            width: 100% !important;
            border-radius: 15px;
            overflow: hidden;
            border: 2px dashed #cbd5e0 !important;
        }

        .btn-action {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }

        .btn-excel { background: var(--success); color: white; }
        .btn-whatsapp { background: var(--whatsapp); color: white; margin-top: 10px; }
        .btn-action:hover { opacity: 0.9; }

        footer { margin: 30px 0; font-size: 12px; color: #95a5a6; text-align: center; }
    </style>
</head>
<body>

<header>
    <h1>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (QR)</h1>
    <p>AL-FARABI UNIVERSITY COLLEGE</p>
</header>

<div class="main-card">
    <div class="class-selector">
        <button onclick="changeClass('A', this)">A</button>
        <button onclick="changeClass('B', this)">B</button>
        <button onclick="changeClass('C', this)">C</button>
        <button onclick="changeClass('D', this)">D</button>
    </div>

    <div class="info-panel">
        <div>Ø§Ù„Ø´Ø¹Ø¨Ø©: <b id="txtGroup">-</b></div>
        <div>Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†: <b id="txtCount">0</b></div>
    </div>

    <div id="reader"></div>

    <button class="btn-action btn-excel" onclick="downloadCSV()">
        ğŸ“„ ØªØµØ¯ÙŠØ± ÙƒØ´Ù Ø§Ù„Ø­Ø¶ÙˆØ± (Excel)
    </button>

    <button class="btn-action btn-whatsapp" onclick="shareWhatsApp()">
        ğŸ’¬ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    </button>

    <button onclick="clearAll()" style="margin-top:20px; background:none; border:none; color:#95a5a6; cursor:pointer; width:100%; font-size:13px;">âš ï¸ Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

<footer>
    ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Ø³Ø¬Ø§Ø¯ Ø­Ø³ÙŠÙ† ÙƒØ§Ø¸Ù…<br>
    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ Â© 2026
</footer>

<script>
    let db = JSON.parse(localStorage.getItem('alf_farabi_db')) || {};
    let currentG = null;
    let scanner = null;

    function changeClass(g, btn) {
        currentG = g;
        document.querySelectorAll('.class-selector button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('txtGroup').innerText = g;
        if(!db[g]) db[g] = [];
        updateUI();
        startScanner();
    }

    function updateUI() {
        if(currentG) document.getElementById('txtCount').innerText = db[currentG].length;
    }

    function startScanner() {
        if(scanner) scanner.clear();
        scanner = new Html5QrcodeScanner("reader", { fps: 15, qrbox: 250 });
        scanner.render((msg) => {
            if(db[currentG].some(s => s.code === msg)) {
                alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
                return;
            }
            const name = msg.split('_')[0] || "Ø·Ø§Ù„Ø¨";
            db[currentG].push({ name: name, code: msg, time: new Date().toLocaleTimeString('ar-EG') });
            localStorage.setItem('alf_farabi_db', JSON.stringify(db));
            updateUI();
            
            const readerDom = document.getElementById('reader');
            readerDom.style.border = "4px solid #27ae60";
            setTimeout(() => readerDom.style.border = "2px dashed #cbd5e0", 500);
        });
    }

    function downloadCSV() {
        if(!currentG || db[currentG].length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");
        let csv = "\uFEFFØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„,Ø§Ù„ÙˆÙ‚Øª\n";
        db[currentG].forEach(r => csv += `"${r.name}","${r.code}","${r.time}"\n`);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Ø­Ø¶ÙˆØ±_Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ_${currentG}.csv`;
        link.click();
    }

    function shareWhatsApp() {
        const url = window.location.href;
        const text = "Ø£Ù‡Ù„Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø±Ø§Ø¨Ø· Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø®Ø§Øµ Ø¨Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ: " + url;
        window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(text));
    }

    function clearAll() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
            localStorage.removeItem('alf_farabi_db');
            location.reload();
        }
    }
</script>

</body>
</html>
